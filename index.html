<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>P치gina secreta para mi novia 仇벒잺</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif; padding:20px; background:#f7f7fb; color:#222; text-align:center; }
    .card { max-width:560px; margin:20px auto; background:white; border-radius:12px; padding:20px; box-shadow:0 8px 24px rgba(0,0,0,0.06); }
    video { width:100%; border-radius:8px; background:#000; }
    #qr-img { width:200px; height:200px; margin: 12px auto; display:block; }
    .hidden { display:none; }
    button { padding:10px 14px; border-radius:8px; border:0; background:#3b82f6; color:white; font-weight:600; cursor:pointer; }
    small { color:#666; display:block; margin-top:8px; }
    #secretContent { text-align:left; }
  </style>
  <!-- Librer칤a de escaneo QR (cliente) -->
  <script src="https://unpkg.com/qr-scanner@1.4.2/qr-scanner.min.js"></script>
</head>
<body>
  <div class="card">
    <h1>Entrada secreta 游눏</h1>
    <p>Para entrar a la sorpresa, escane치 el c칩digo QR con la c치mara. Si el c칩digo coincide, se desbloquea la p치gina.</p>

    <!-- Ejemplo de QR (reemplaz치 el texto CODIGOSECRETO123 por lo que quieras) -->
    <img id="qr-img" alt="QR de ejemplo" src="https://chart.googleapis.com/chart?chs=300x300&cht=qr&chl=CODIGOSECRETO123&choe=UTF-8">

    <p><strong>쯅o pod칠s usar la c치mara?</strong></p>
    <input type="file" id="file-input" accept="image/*"><br><small>Sub칤 la foto del QR si prefer칤s</small>

    <hr>

    <div id="scanner-area">
      <video id="video" muted playsinline></video>
      <div style="margin-top:10px">
        <button id="startBtn">Iniciar c치mara</button>
        <button id="stopBtn" class="hidden">Detener</button>
      </div>
      <small id="status">Estado: esperando inicio.</small>
    </div>

    <hr>

    <div id="result" class="hidden">
      <h2>Escaneado 九덢잺</h2>
      <p id="scannedText"></p>
      <p>Si el c칩digo es correcto, ver치s la sorpresa abajo.</p>
    </div>

    <div id="locked" style="margin-top:12px;">
      <h3>Estado: 游 Bloqueado</h3>
      <p>Escane치 el QR correcto para desbloquear.</p>
    </div>

    <div id="unlocked" class="hidden" style="margin-top:14px;">
      <h3>춰Bienvenida! 游댑</h3>
      <div id="secretContent">
        <!-- Personaliz치 el contenido de la sorpresa ac치 -->
        <h2>Para mi amor, <span id="nombre">[Nombre]</span> 游눘</h2>
        <p>Te amo. Gracias por ser tan especial. Esto es solo para vos. 游땢</p>
        <p>Puedes cambiar este mensaje en el HTML para hacerlo m치s personal (a침ad칤 fotos, m칰sica, etc.).</p>
      </div>
    </div>

  </div>

<script>
/*
  C칩mo funciona:
  - Defin칤 el SECRETCODE abajo (string exacto). Gener치 un QR que contenga exactamente ese texto.
  - El ejemplo de imagen usa: CODIGOSECRETO123
  - Cambi치 SECRETCODE por lo que quieras y regener치 el QR (o reemplaz치 la imagen QR).
*/
const SECRETCODE = "CODIGOSECRETO123"; // <-- PON칄 TU C칍DIGO AQU칈 (sensitivo a may칰sculas/min칰sculas)

const video = document.getElementById('video');
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const status = document.getElementById('status');
const result = document.getElementById('result');
const scannedText = document.getElementById('scannedText');
const locked = document.getElementById('locked');
const unlocked = document.getElementById('unlocked');
const fileInput = document.getElementById('file-input');

let qrScanner = null;

QrScanner.WORKER_PATH = 'https://unpkg.com/qr-scanner@1.4.2/qr-scanner-worker.min.js';

// Iniciar c치mara y escaneo
startBtn.addEventListener('click', async () => {
  startBtn.disabled = true;
  status.textContent = 'Estado: inicializando c치mara...';
  try {
    qrScanner = new QrScanner(video, resultText => {
      onScan(resultText);
    }, { returnDetailedScanResult: true });

    await qrScanner.start();
    status.textContent = 'Estado: c치mara activa. Apunt치 al QR.';
    startBtn.classList.add('hidden');
    stopBtn.classList.remove('hidden');
  } catch (e) {
    console.error(e);
    status.textContent = 'Error al iniciar c치mara. Prob치 con la opci칩n de subir imagen.';
    startBtn.disabled = false;
  }
});

stopBtn.addEventListener('click', () => {
  if (qrScanner) {
    qrScanner.stop();
    qrScanner.destroy();
    qrScanner = null;
  }
  status.textContent = 'Estado: detenido.';
  startBtn.classList.remove('hidden');
  stopBtn.classList.add('hidden');
  startBtn.disabled = false;
});

// Manejo de imagen subida (fallback)
fileInput.addEventListener('change', async (e) => {
  const f = e.target.files[0];
  if (!f) return;
  status.textContent = 'Estado: analizando imagen...';
  try {
    const result = await QrScanner.scanImage(f, { returnDetailedScanResult: true });
    onScan(result.data || result);
  } catch(err) {
    console.error(err);
    status.textContent = 'No se detect칩 un QR v치lido en la imagen.';
  }
});

function onScan(text) {
  result.classList.remove('hidden');
  scannedText.textContent = Texto detectado: "${text}";
  status.textContent = 'Estado: QR detectado.';
  // comparar con el secreto (match exacto)
  if (String(text).trim() === SECRETCODE) {
    unlock();
  } else {
    fail();
  }
}

function unlock() {
  locked.classList.add('hidden');
  unlocked.classList.remove('hidden');
  status.textContent = 'Estado: desbloqueado 游꿀';
  // detener c치mara si est치 encendida
  if (qrScanner) {
    qrScanner.stop();
    qrScanner.destroy();
    qrScanner = null;
    startBtn.classList.remove('hidden');
    stopBtn.classList.add('hidden');
  }
}

function fail() {
  locked.classList.remove('hidden');
  unlocked.classList.add('hidden');
  status.textContent = 'Estado: c칩digo incorrecto. Intent치 otra vez.';
}

// Opcional: personalizar nombre en el contenido desbloqueado
document.getElementById('nombre').textContent = "Mi amor"; // cambi치 si quer칠s
</script>
</body>
</html>
